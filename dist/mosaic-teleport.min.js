/*! mosaic-teleport 2014-07-13 */
require=function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(){},{}],2:[function(a,b){(function(c){!function(a){"use strict";var d=b.exports=a("mosaic-commons");a("./Mosaic.ApiDescriptor");var e="undefined"!=typeof window?window.Mosaic.libs.underscore:"undefined"!=typeof c?c.Mosaic.libs.underscore:null,f="undefined"!=typeof window?window.Mosaic.libs.superagent:"undefined"!=typeof c?c.Mosaic.libs.superagent:null;d.ApiDescriptor.SuperagentClientStub=d.ApiDescriptor.HttpClientStub.extend({initialize:function(a){if(!a.descriptor)throw d.Errors.newError("API descriptor is not defined");this.client=f.agent();var b=this.class.parent.prototype.initialize;b.call(this,a.descriptor,a)},_http:function(a,b,c){var d=a.method;"delete"==d&&(d="del");var f=this.client[d](a.url);e.each(a.headers,function(a,b){f=f.set(b,a)}),f=f.send(a.body),f.end(function(a,d){try{d?(b.status=d.status,e.extend(b.headers,d.headers||{}),b.body=d.body):b.status=a&&a.status?a.status:500,c(a)}catch(f){c(f)}})}})}(a)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Mosaic.ApiDescriptor":3}],3:[function(a,b){(function(c){!function(a){"use strict";var d=b.exports=a("mosaic-commons");a("./Mosaic.PathMapper");var e="undefined"!=typeof window?window.Mosaic.libs.underscore:"undefined"!=typeof c?c.Mosaic.libs.underscore:null;d.ApiDescriptor=d.Class.extend({initialize:function(){this._config={},this.mapper=new d.PathMapper},add:function(a,b,c){var d=this._config[a]=this._config[a]||{};return d[b]=c,this.mapper.add(a,d),this},get:function(a){return this.mapper.find(a)}});var f=d.Class.extend({_wrapHandleMethod:function(a){return function(b,c){var e=this;return d.P.fin(d.P.then(function(){return e._beginHttpCall({req:b,res:c,stub:e})}).then(function(){return a.call(e,b,c)}),function(a,d){return e._endHttpCall({req:b,res:c,stub:e,err:a,result:d})})}},_beginHttpCall:function(a){e.isFunction(this.options.beginHttpCall)&&this.options.beginHttpCall(a)},_endHttpCall:function(a){e.isFunction(this.options.endHttpCall)&&this.options.endHttpCall(a)}});d.ApiDescriptor.HttpServerStub=f.extend({initialize:function(a){if(this.setOptions(a),!a.descriptor)throw d.Errors.newError(501,"API descriptor is not defined");this.descriptor=a.descriptor,this._doHandle=this._wrapHandleMethod(this._doHandle)},handle:function(a,b){var c=this;return d.P.then(function(){return c._doHandle(a,b)}).then(function(a){b.send(200,a||"")},function(a){var c=d.Errors.toJSON(a),e=c.status||500;b.send(e,c)})},_getInstance:function(){var a=this.options||{},b=a.instance||this;return b},_callMethod:function(a,b,c,e){var f=this,g=f._getInstance(c,e,a,b),h=g[a];if(!h)throw d.Errors.newError('Method "'+a+'" is not implemented').code(500);var i=f._getMethodParams(a,b,c,e);return h.call(g,i)},_getMethodParams:function(a,b,c){return e.extend({},c.query,c.body,c.cookies,b)},_doHandle:function(a,b){var c=this,e=c._getPath(a),f=a.method.toLowerCase(),g=c.descriptor.get(e);if(!g)throw d.Errors.newError('Path not found "'+e+'"').code(404);var h=g.obj[f];if(!h)throw d.Errors.newError('HTTP method "'+f.toUpperCase()+'" is not supported. Path: "'+e+'".').code(404);return c._callMethod(h,g.params,a,b)},_getPath:function(a){var b=a.path;if(!b||""===b){var c=a.url||"",d=c.indexOf("?");d>=0&&(c=c.substring(0,d)),d=c.indexOf("#"),d>=0&&(c=c.substring(0,d)),d=c.indexOf("/"),d>0&&(c=c.substring(d)),b=c}var e=this.options||{},f=e.pathPrefix||"";return b.substring(f.length)}}),d.ApiDescriptor.HttpClientStub=f.extend({initialize:function(a,b){this.descriptor=a,this.setOptions(b);var c=this;this.handle=this._wrapHandleMethod(this.handle);var d=c.descriptor._config;e.each(d,function(a,b){e.each(a,function(a,d){c[a]=function(a){var e=c._newHttpRequest(b,d,a),f=c._newHttpResponse(e);return c.handle(e,f)}})})},_newHttpRequest:function(a,b,c){c=c||{};var f=d.PathMapper.formatPath(a,c),g=this._toUrl(f);return{id:e.uniqueId("req-"),url:g,method:b,query:{},headers:{},body:c||{}}},_newHttpResponse:function(a){return{id:a.id,status:200,headers:{},body:null,error:null}},handle:function(a,b){var c=this,e=d.P.defer();try{c._http(a,b,function(a){try{if(!a){var c=parseInt(b.status)/100;c=100*parseInt(c),200!=c&&(a=b.body&&b.body.trace?d.Errors.fromJSON(b.body).code(b.status):d.Errors.newError(""+b.status).code(b.status))}if(a)throw a;e.resolve(b.body)}catch(f){e.reject(f)}})}catch(f){e.reject(f)}return e.promise},_toUrl:function(a){var b=this.options||{},c=b.baseUrl||"";return c+a},_http:function(a,b,c){var e=d.Errors.newError("Not implemented");c(e)}})}(a)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Mosaic.PathMapper":4}],4:[function(a,b){(function(c){function d(a){return a.replace(i,"\\$&")}function e(a){return"("+a+")"}var f=b.exports=a("mosaic-commons"),g="undefined"!=typeof window?window.Mosaic.libs.underscore:"undefined"!=typeof c?c.Mosaic.libs.underscore:null,h=f.PathMapper=f.Class.extend({initialize:function(){var a=this;a.handlers=[]},add:function(a,b){var c=this,f=[],h=[],i=!1;g.each(a.split("*"),function(a){var b=!1;g.each(a.split(":"),function(a){if(i||b){if(i||b){var c=a.indexOf("/"),g=b?"[^/]+":".*?";c>=0?(f.push(e(g)),h.push(a.substring(0,c)),f.push(d(a.substring(c)))):(f.push(e(g)),h.push(a))}}else f.push(d(a));b=!0}),i=!0});var j=f.join(""),k=new RegExp("^"+j+"$");c.handlers.push({mask:a,regexp:k,names:h,obj:b})},find:function(a){var b=this,c=null;return g.any(b.handlers,function(b){if(b.regexp.test(a)){var d={},e=b.regexp.exec(a).slice(1),f=0;return g.each(e,function(a){var c=b.names[f++],e=a?decodeURIComponent(a):null;d[c]=e}),c={params:d,obj:b.obj},!0}}),c},remove:function(a){var b=this,c=null;return b.handlers=g.filter(b.handlers,function(b){var d=!0;return b.mask===a&&(c=b.obj,d=!1),d}),c}});h.formatPath=function(a,b){b=b||{};for(var c=a.split(/[:\*]/gim),d=[],e=0;e<c.length;e++){var f=c[e];if(0===e)""!==f&&d.push(f);else{var g=null,h=f.indexOf("/");h>=0?(g=f.substring(0,h),f=f.substring(h)):(g=f,f=null);var i=b[g];if(!i){var j='Required parameter "'+g+'" not defined.',k=new Error(j);throw k._code=400,k}delete b[g],d.push(i),f&&""!==f&&d.push(f)}}return d.join("")};var i=/[\-{}\[\]+?.,\\\^$|#\s]/g}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],"mosaic-teleport":[function(a,b){b.exports=a("H99CHA")},{}],H99CHA:[function(a,b){b.exports=a("mosaic-commons"),a("./Mosaic.ApiDescriptor"),a("./Mosaic.PathMapper"),a("./Mosaic.ApiDescriptor.SuperagentClientStub")},{"./Mosaic.ApiDescriptor":3,"./Mosaic.ApiDescriptor.SuperagentClientStub":2,"./Mosaic.PathMapper":4}]},{},["H99CHA"]);